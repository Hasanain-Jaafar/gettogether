{
  "permissions": {
    "allow": [
      "Bash(npm run build:*)",
      "Bash(npx eslint \"src/components/profile/profile-form.tsx\")",
      "Bash(ls:*)",
      "Bash(npx tsc --noEmit)",
      "Bash(/e/Code/GitHub/gettogether/src/app/\\\\\\(dashboard\\\\\\)/actions/posts.ts << 'POSTS_EOF'\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { createPostSchema, updatePostSchema } from \"@/lib/validations/post\";\nimport { notifyMentionedUsers } from \"./mentions\";\n\nconst RATE_LIMIT_POSTS_PER_HOUR = 10;\n\nexport type PostResult = { success: true; postId?: string } | { success: false; error: string };\n\nexport async function createPost\\(\n  input: { content: string; image_url?: string | null; media_type?: string | null }\n\\): Promise<PostResult> {\n  const parsed = createPostSchema.safeParse\\(input\\);\n  if \\(!parsed.success\\) {\n    const msg = parsed.error.flatten\\(\\).formErrors?.[0] ?? \"Invalid input.\";\n    return { success: false, error: msg };\n  }\n\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  const { count } = await supabase\n    .from\\(\"posts\"\\)\n    .select\\(\"id\", { count: \"exact\", head: true }\\)\n    .eq\\(\"user_id\", user.id\\)\n    .gte\\(\"created_at\", new Date\\(Date.now\\(\\) - 60 * 60 * 1000\\).toISOString\\(\\)\\);\n\n  if \\(count !== null && count >= RATE_LIMIT_POSTS_PER_HOUR\\) {\n    return { success: false, error: \"Rate limit: try again later.\" };\n  }\n\n  // Determine media type\n  let mediaType = \"text\";\n  if \\(parsed.data.media_type\\) {\n    mediaType = parsed.data.media_type;\n  } else if \\(parsed.data.image_url\\) {\n    const url = parsed.data.image_url.toLowerCase\\(\\);\n    if \\(url.includes\\(\".gif\"\\) || url.includes\\(\"gif\"\\)\\) {\n      mediaType = \"gif\";\n    } else if \\(url.includes\\(\".mp4\"\\) || url.includes\\(\".webm\"\\) || url.includes\\(\"video\"\\)\\) {\n      mediaType = \"video\";\n    } else {\n      mediaType = \"image\";\n    }\n  }\n\n  const { data: post, error } = await supabase\n    .from\\(\"posts\"\\)\n    .insert\\({\n      user_id: user.id,\n      content: parsed.data.content.trim\\(\\),\n      image_url: parsed.data.image_url ?? null,\n      media_type: mediaType,\n    }\\)\n    .select\\(\"id\"\\)\n    .single\\(\\);\n\n  if \\(error\\) return { success: false, error: error.message };\n\n  // Notify mentioned users\n  await notifyMentionedUsers\\(post.id, parsed.data.content, user.id\\);\n\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n  return { success: true, postId: post.id };\n}\n\nexport async function updatePost\\(\n  postId: string,\n  input: { content: string; image_url?: string | null }\n\\): Promise<PostResult> {\n  const parsed = updatePostSchema.safeParse\\(input\\);\n  if \\(!parsed.success\\) {\n    const msg = parsed.error.flatten\\(\\).formErrors?.[0] ?? \"Invalid input.\";\n    return { success: false, error: msg };\n  }\n\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  const { error } = await supabase\n    .from\\(\"posts\"\\)\n    .update\\({\n      content: parsed.data.content.trim\\(\\),\n      image_url: parsed.data.image_url ?? null,\n    }\\)\n    .eq\\(\"id\", postId\\)\n    .eq\\(\"user_id\", user.id\\);\n\n  if \\(error\\) return { success: false, error: error.message };\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n  revalidatePath\\(`/u/${user.id}`\\);\n  return { success: true };\n}\n\nexport async function deletePost\\(postId: string\\): Promise<PostResult> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  const { error } = await supabase\n    .from\\(\"posts\"\\)\n    .delete\\(\\)\n    .eq\\(\"id\", postId\\)\n    .eq\\(\"user_id\", user.id\\);\n\n  if \\(error\\) return { success: false, error: error.message };\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n  revalidatePath\\(`/u/${user.id}`\\);\n  return { success: true };\n}\nPOSTS_EOF)",
      "Bash(npm install:*)",
      "Bash(head:*)",
      "Bash(/e/Code/GitHub/gettogether/src/app/\\\\\\(dashboard\\\\\\)/actions/reactions.ts << 'REACTIONS_EOF'\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport type ReactionResult =\n  | { success: true; reaction: { emoji: string; count: number } | null }\n  | { success: false; error: string };\n\nexport type PostReaction = {\n  emoji: string;\n  count: number;\n  userReacted?: boolean;\n};\n\nexport const COMMON_REACTIONS = [\"ðŸ‘\", \"â¤ï¸\", \"ðŸ˜‚\", \"ðŸ˜®\", \"ðŸ˜¢\", \"ðŸ˜¡\", \"ðŸŽ‰\", \"ðŸ”¥\"];\n\nexport async function setReaction\\(\n  postId: string,\n  emoji: string\n\\): Promise<ReactionResult> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  // Check if user already has any reaction on this post\n  const { data: existing } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"id, emoji\"\\)\n    .eq\\(\"post_id\", postId\\)\n    .eq\\(\"user_id\", user.id\\)\n    .maybeSingle\\(\\);\n\n  // If user is changing their reaction to the same one, remove it\n  if \\(existing && existing.emoji === emoji\\) {\n    const { error } = await supabase\n      .from\\(\"reactions\"\\)\n      .delete\\(\\)\n      .eq\\(\"id\", existing.id\\);\n    if \\(error\\) return { success: false, error: error.message };\n    revalidatePath\\(\"/dashboard\"\\);\n    revalidatePath\\(\"/profile\"\\);\n    return { success: true, reaction: null };\n  }\n\n  // If user has a different reaction, delete it first\n  if \\(existing\\) {\n    const { error: deleteError } = await supabase\n      .from\\(\"reactions\"\\)\n      .delete\\(\\)\n      .eq\\(\"id\", existing.id\\);\n    if \\(deleteError\\) return { success: false, error: deleteError.message };\n  }\n\n  // Add the new reaction\n  const { error } = await supabase.from\\(\"reactions\"\\).insert\\({\n    post_id: postId,\n    user_id: user.id,\n    emoji,\n  }\\);\n  if \\(error\\) return { success: false, error: error.message };\n\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n\n  // Get the reaction count\n  const { data: reactions } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"emoji\", { count: \"exact\", head: true }\\)\n    .eq\\(\"post_id\", postId\\)\n    .eq\\(\"emoji\", emoji\\);\n\n  const count = reactions?.[0]?.count ?? 0;\n\n  return {\n    success: true,\n    reaction: { emoji, count },\n  };\n}\n\nexport async function removeReaction\\(\n  postId: string,\n  emoji: string\n\\): Promise<ReactionResult> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  const { error } = await supabase\n    .from\\(\"reactions\"\\)\n    .delete\\(\\)\n    .eq\\(\"post_id\", postId\\)\n    .eq\\(\"user_id\", user.id\\)\n    .eq\\(\"emoji\", emoji\\);\n\n  if \\(error\\) return { success: false, error: error.message };\n\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n\n  return { success: true, reaction: null };\n}\n\nexport async function getPostReactions\\(\n  postId: string\n\\): Promise<PostReaction[]> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n\n  const { data: reactions, error } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"emoji\"\\)\n    .eq\\(\"post_id\", postId\\);\n\n  if \\(error\\) return [];\n\n  // Count reactions by emoji\n  const reactionCounts = new Map<string, { count: number; userReacted: boolean }>\\(\\);\n\n  // Get user's reactions\n  let userReactions: string[] = [];\n  if \\(user\\) {\n    const { data: userReactionsData } = await supabase\n      .from\\(\"reactions\"\\)\n      .select\\(\"emoji\"\\)\n      .eq\\(\"post_id\", postId\\)\n      .eq\\(\"user_id\", user.id\\);\n    userReactions = userReactionsData?.map\\(\\(r\\) => r.emoji\\) ?? [];\n  }\n\n  reactions?.forEach\\(\\(r\\) => {\n    const existing = reactionCounts.get\\(r.emoji\\) ?? { count: 0, userReacted: false };\n    reactionCounts.set\\(r.emoji, {\n      count: existing.count + 1,\n      userReacted: existing.userReacted || userReactions.includes\\(r.emoji\\),\n    }\\);\n  }\\);\n\n  return Array.from\\(reactionCounts.entries\\(\\)\\)\n    .sort\\(\\(a, b\\) => b[1].count - a[1].count\\)\n    .map\\(\\([emoji, data]\\) => \\({\n      emoji,\n      count: data.count,\n      userReacted: data.userReacted,\n    }\\)\\);\n}\n\nexport async function getUserReactionsOnPosts\\(\n  userId: string,\n  postIds: string[]\n\\): Promise<Map<string, string[]>> {\n  const supabase = await createClient\\(\\);\n\n  const { data, error } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"post_id, emoji\"\\)\n    .eq\\(\"user_id\", userId\\)\n    .in\\(\"post_id\", postIds\\);\n\n  if \\(error\\) return new Map\\(\\);\n\n  const userReactions = new Map<string, string[]>\\(\\);\n  data?.forEach\\(\\(r\\) => {\n    const existing = userReactions.get\\(r.post_id\\) ?? [];\n    existing.push\\(r.emoji\\);\n    userReactions.set\\(r.post_id, existing\\);\n  }\\);\n\n  return userReactions;\n}\nREACTIONS_EOF)",
      "Bash(/e/Code/GitHub/gettogether/src/app/\\\\\\(dashboard\\\\\\)/actions/reactions.ts << 'REACTIONS_EOF'\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport type ReactionResult =\n  | { success: true; reaction: { emoji: string; count: number } | null }\n  | { success: false; error: string };\n\nexport type PostReaction = {\n  emoji: string;\n  count: number;\n  userReacted?: boolean;\n};\n\nexport const COMMON_REACTIONS = [\"ðŸ‘\", \"â¤ï¸\", \"ðŸ˜‚\", \"ðŸ˜®\", \"ðŸ˜¢\", \"ðŸ˜¡\", \"ðŸŽ‰\", \"ðŸ”¥\"];\n\nexport async function setReaction\\(\n  postId: string,\n  emoji: string\n\\): Promise<ReactionResult> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  // Check if user already has any reaction on this post\n  const { data: existing } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"id, emoji\"\\)\n    .eq\\(\"post_id\", postId\\)\n    .eq\\(\"user_id\", user.id\\)\n    .maybeSingle\\(\\);\n\n  // If user is changing their reaction to the same one, remove it\n  if \\(existing && existing.emoji === emoji\\) {\n    const { error } = await supabase\n      .from\\(\"reactions\"\\)\n      .delete\\(\\)\n      .eq\\(\"id\", existing.id\\);\n    if \\(error\\) return { success: false, error: error.message };\n    revalidatePath\\(\"/dashboard\"\\);\n    revalidatePath\\(\"/profile\"\\);\n    return { success: true, reaction: null };\n  }\n\n  // If user has a different reaction, delete it first\n  if \\(existing\\) {\n    const { error: deleteError } = await supabase\n      .from\\(\"reactions\"\\)\n      .delete\\(\\)\n      .eq\\(\"id\", existing.id\\);\n    if \\(deleteError\\) return { success: false, error: deleteError.message };\n  }\n\n  // Add the new reaction\n  const { error } = await supabase.from\\(\"reactions\"\\).insert\\({\n    post_id: postId,\n    user_id: user.id,\n    emoji,\n  }\\);\n  if \\(error\\) return { success: false, error: error.message };\n\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n\n  // Get the reaction count\n  const { data: reactions } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"*\", { count: \"exact\", head: true }\\)\n    .eq\\(\"post_id\", postId\\)\n    .eq\\(\"emoji\", emoji\\);\n\n  const count = reactions?.length ?? 0;\n\n  return {\n    success: true,\n    reaction: { emoji, count },\n  };\n}\n\nexport async function removeReaction\\(\n  postId: string,\n  emoji: string\n\\): Promise<ReactionResult> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n  if \\(!user\\) return { success: false, error: \"Not authenticated.\" };\n\n  const { error } = await supabase\n    .from\\(\"reactions\"\\)\n    .delete\\(\\)\n    .eq\\(\"post_id\", postId\\)\n    .eq\\(\"user_id\", user.id\\)\n    .eq\\(\"emoji\", emoji\\);\n\n  if \\(error\\) return { success: false, error: error.message };\n\n  revalidatePath\\(\"/dashboard\"\\);\n  revalidatePath\\(\"/profile\"\\);\n\n  return { success: true, reaction: null };\n}\n\nexport async function getPostReactions\\(\n  postId: string\n\\): Promise<PostReaction[]> {\n  const supabase = await createClient\\(\\);\n  const {\n    data: { user },\n  } = await supabase.auth.getUser\\(\\);\n\n  const { data: reactions, error } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"emoji\"\\)\n    .eq\\(\"post_id\", postId\\);\n\n  if \\(error\\) return [];\n\n  // Count reactions by emoji\n  const reactionCounts = new Map<string, { count: number; userReacted: boolean }>\\(\\);\n\n  // Get user's reactions\n  let userReactions: string[] = [];\n  if \\(user\\) {\n    const { data: userReactionsData } = await supabase\n      .from\\(\"reactions\"\\)\n      .select\\(\"emoji\"\\)\n      .eq\\(\"post_id\", postId\\)\n      .eq\\(\"user_id\", user.id\\);\n    userReactions = userReactionsData?.map\\(\\(r\\) => r.emoji\\) ?? [];\n  }\n\n  reactions?.forEach\\(\\(r\\) => {\n    const existing = reactionCounts.get\\(r.emoji\\) ?? { count: 0, userReacted: false };\n    reactionCounts.set\\(r.emoji, {\n      count: existing.count + 1,\n      userReacted: existing.userReacted || userReactions.includes\\(r.emoji\\),\n    }\\);\n  }\\);\n\n  return Array.from\\(reactionCounts.entries\\(\\)\\)\n    .sort\\(\\(a, b\\) => b[1].count - a[1].count\\)\n    .map\\(\\([emoji, data]\\) => \\({\n      emoji,\n      count: data.count,\n      userReacted: data.userReacted,\n    }\\)\\);\n}\n\nexport async function getUserReactionsOnPosts\\(\n  userId: string,\n  postIds: string[]\n\\): Promise<Map<string, string[]>> {\n  const supabase = await createClient\\(\\);\n\n  const { data, error } = await supabase\n    .from\\(\"reactions\"\\)\n    .select\\(\"post_id, emoji\"\\)\n    .eq\\(\"user_id\", userId\\)\n    .in\\(\"post_id\", postIds\\);\n\n  if \\(error\\) return new Map\\(\\);\n\n  const userReactions = new Map<string, string[]>\\(\\);\n  data?.forEach\\(\\(r\\) => {\n    const existing = userReactions.get\\(r.post_id\\) ?? [];\n    existing.push\\(r.emoji\\);\n    userReactions.set\\(r.post_id, existing\\);\n  }\\);\n\n  return userReactions;\n}\nREACTIONS_EOF)",
      "Bash(npx eslint:*)",
      "Bash(npx supabase db reset:*)",
      "Bash(npx supabase migration up:*)",
      "Bash(npx supabase db push:*)",
      "Bash(npx supabase link:*)",
      "Bash(npx supabase login:*)",
      "Bash(npx supabase migration list:*)"
    ]
  }
}
